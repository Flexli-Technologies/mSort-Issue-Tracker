name: Auto Assign Issues

on:
  issues:
    types: [opened, labeled]

jobs:
  auto-assign:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    
    steps:
      - name: Assign based on label or keywords
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const issueBody = (issue.body || '').toLowerCase();
            const issueTitle = (issue.title || '').toLowerCase();
            const labels = issue.labels.map(label => label.name.toLowerCase());
            
            let assignee = null;
            
            // Check labels first (priority)
            if (labels.includes('category:electronics')) {
              assignee = 'mayoogh-flexli';
            } else if (labels.includes('category:mechanical')) {
              assignee = 'TusharRflexli';
            } else if (labels.includes('category:embedded')) {
              assignee = 'FlexliTushar';
            } else if (labels.includes('category:software')) {
              assignee = 'FlexliTushar';
            }
            
            // If no label match, check keywords in title and body
            if (!assignee) {
              const content = issueTitle + ' ' + issueBody;
              
              if (content.includes('firmware') || content.includes('code') || content.includes('program')) {
                assignee = 'FlexliTushar';
              } else if (content.includes('mechanical')) {
                assignee = 'TusharRflexli';
              } else if (content.includes('harness') || content.includes('pcb')) {
                assignee = 'mayoogh-flexli';
              }
            }
            
            // Assign the issue if assignee is determined
            if (assignee) {
              try {
                await github.rest.issues.addAssignees({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue.number,
                  assignees: [assignee]
                });
                console.log(`Assigned issue #${issue.number} to ${assignee}`);
              } catch (error) {
                console.error(`Failed to assign: ${error.message}`);
              }
            } else {
              console.log('No matching criteria found for auto-assignment');
            }
